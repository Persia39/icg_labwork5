<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Лабораторная</title>
    <link rel="stylesheet" href="https://www.x3dom.org/download/dev/x3dom.css" />
    <script src="https://www.x3dom.org/download/1.7.2/x3dom-full.js"></script>
    <link rel="stylesheet" href="../css/custom.css" />
    <script src="../js/custom.js"></script>
	<script>
	var j=-30
	var tor=0
	var y=1
	var olen=0
	var numgroup=0
	var transolen=0
	var trav=0
	
		document.onload = function () {
			document.getElementById("Dvizol").setAttribute("enabled", 'false')
			document.getElementById("Dvizol").setAttribute("loop", 'false')
			document.getElementById("Solnc").setAttribute("translation", '0 30 30')
			}
		function Reload()
		{
			interval = setInterval(() => {
				document.getElementById("Deern1").setAttribute("translation", "-1 "+y+" "+ 0)
				y++
				}, 20)
		}
		
		function Flyto()
		{
			var objSel = document.myForm.mySelect
			var olenname
			if(objSel.selectedIndex==0)
				{interval = setInterval(() => {
				document.getElementById("group1").setAttribute("translation", "0 "+olen+" "+olen)
				objSel.options[0] = null
				numgroup=1
				olen++
				}, 20)}
			else {{interval = setInterval(() => {
				document.getElementById("group2").setAttribute("translation", "0 "+olen+" "+olen)
				objSel.options[1] = null
				olen++
				numgroup=0
				}, 20)}}
			
				
		}
		function Startapokal()
		{
			var j=30
			interval = setInterval(() => {
			mas=new Array(41)
			if(j>0)
			{
				document.getElementById("Solnc").setAttribute("translation", "0 "-j+" "+j)
				j-=0.3
				tor =1
			}
			for (var i=0;i<41;i++)
			{
				mas[i]=Math.floor(Math.random()*(5-1+1))+1
			}
			document.getElementById("lava").setAttribute("height",mas.join(",") )
			}, 30)
			document.getElementById("nametrsolnc").setAttribute("toNode", 'Solnc')
			document.getElementById("Dvizsol").setAttribute("enabled", 'true')
			document.getElementById("Dvizsol").setAttribute("loop", 'false')	
		}
		function Moonf()
		{
			if(numgroup==0)
			{
				document.getElementById("mymoon").setAttribute("translation", '-24 -4.6 -5')
				document.getElementById("mymoon").setAttribute("scale", '20 10 10')
			}
			else{
				document.getElementById("mymoon").setAttribute("translation", '-24 -3 4')
				document.getElementById("mymoon").setAttribute("scale", '20 10 10')
			}
		}
		function Gotomoon()
		{
			if(numgroup==0 && tor==0)
			{
				interval = setInterval(() => {
					if(transolen<76)
					{
						document.getElementById("group1").setAttribute("translation", -0.3*transolen +" "+transolen*0.1+" "+0)
						transolen++
					}
				}, 30)
			}
			if(numgroup==1 && tor==0)
			{
				interval = setInterval(() => {
					if(transolen<76)
					{
						document.getElementById("group2").setAttribute("translation", -0.3*transolen +" "+transolen*0.1+" "+0)
						transolen++
					}
				}, 30)
			}
		}
		function travel()
		{
			if(numgroup==0)
			{
				interval = setInterval(() => {
						document.getElementById("group1").setAttribute("translation", -24-trav+" 7 0")
						transolen++
						document.getElementById("mymoon").setAttribute("translation", -24-trav+" "+"-4.6 -5")
						trav++
				}, 30)
			}
			if(numgroup==1){
			interval = setInterval(() => {
						document.getElementById("group2").setAttribute("translation", -24-trav+" 7.8 0")
						transolen++
						document.getElementById("mymoon").setAttribute("translation", -24-trav+" "+"-3 4")
						trav++
				}, 30)
			}
		}
		function Sol()
		{
			document.getElementById("Solnc").setAttribute("translation","0 0 0")
		}
	</script>
	
</head>

<body>
<input type="button" id="but_m" value="Спасти вожака"onclick='Reload();'>
<input type="button" id="but_e" value="Последовать за вожаком"onclick='Flyto();'>
<input type="button" id="but_e" value="Неожиданное спасение"onclick='Moonf();'>
<input type="button" id="but_e" value="Переселение"onclick='Gotomoon();'>
<input type="button" id="but_apokal" value="Начать аппокалипсис"onclick='Startapokal();'>
<input type="button" id="but_apokal" value="Конец!"onclick='travel();'>
<input type="button" id="but_m" value="Движение солнца"onclick='Sol();'>
<form name="myForm">
  <select id="mySelectId" name="mySelect">
    <option value="str0"> 1 группа </option>
    <option value="str1"> 2 группа </option>
  </select>
</form>
<h1>Лабораторная работа №5. Финал.</h1>

<p>
Сцена с оленями. 
</p>

<X3D  width="1024" height="600">
	<scene>
			<Background backurl='starsbg.png'> </Background>
			<Shape>
				  <Appearance>
					<Material diffuseColor='orange'></Material>
				  </Appearance>
				  <Box size="2.3 .3 1.9"></Box>
			</Shape>
			<Transform translation='-0.9 -0.4 -0.5'> 
				<Shape>
					  <Appearance>
						<Material diffuseColor='orange'></Material>
					  </Appearance>
					  <Box size="0.2 1 0.2"></Box>
				</Shape>
				<Transform translation='0 0 1'> 
					<Shape>
						  <Appearance>
							<Material diffuseColor='orange'></Material>
						  </Appearance>
						  <Box size="0.2 1 0.2"></Box>
					</Shape>
					<Transform translation='1.8 0 0' > 
						<Shape>
							  <Appearance>
								<Material diffuseColor='orange'></Material>
							  </Appearance>
							  <Box size="0.2 1 0.2"></Box>
						</Shape>
						<Transform translation='0 0 -1'> 
							<Shape>
								  <Appearance>
									<Material diffuseColor='orange'></Material>
								  </Appearance>
								  <Box size="0.2 1 0.2"></Box>
							</Shape>
							<Transform  DEF="Trad1" id="Deern1" translation='-0.9 0.5 -0.2' scale="1 1 1"> 
								<inline  url="Deer.x3d"> </inline>
							</Transform>
						</Transform>
					</Transform>
				</Transform>
				<Transform>
					<Transform translation='0 -1 0'> 
						<Transform id="group1" rotation = "0 1 0 3.2" >
							<Group DEF="der">
								<Transform translation='0 0 2' center="0 0 2" DEF="derk" scale="1 1 1" > 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='0 0 5' center="0 1 1" DEF="derk1" scale="1 1 1" > 
										<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='2 0 2' center="0 1 1" DEF="derk2" scale="1 1 1" > 
										<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='2 0 5' center="0 1 1" DEF="derk3" scale="1 1 1"> 
										<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='-2 0 5' center="0 1 1" DEF="derk4" scale="1 1 1"> 
										<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='-2 0 2' center="0 1 1" DEF="derk5" scale="1 1 1"> 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='4 0 2' center="0 1 1" DEF="derk6" scale="1 1 1"> 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='4 0 5' center="0 1 1" DEF="derk7" scale="1 1 1"> 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='-4 0 2' center="0 1 1" DEF="derk8" scale="1 1 1"> 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
								<Transform translation='-4 0 5' center="0 1 1" DEF="derk9" scale="1 1 1"> 
									<inline  url="Deer.x3d"> </inline>
								</Transform>
							</Group>
						</Transform>
					</Transform>
				</Transform>
				<Transform id="mymoon" translation='0 3 4' >
					<Shape>
					  <Appearance>
						<ImageTexture url="moon.jpg"></ImageTexture>
					  </Appearance>
					  <Sphere radius="1.1"></Sphere>
					</Shape>
				</Transform>
			</Transform>
			<Transform translation='0 -1 0'> 
						<Shape>
							  <Appearance>
								<Material diffuseColor='orange'></Material>
							  </Appearance>
							  <Box size="5 0.5 2"></Box>
						</Shape>
			</Transform>
			<Transform translation='0 1 -6'>
				<Anchor url="https://vk.com/alexerandr">
					<Shape>			
						<Appearance>
							<Material diffuseColor='red'></Material>
						</Appearance>
						<Text string='"deers fly to the moon"' solid='false'>
						</Text>
					</Shape>
				</Anchor>
			</Transform>
			<Transform translation='-4 -1 4' rotation="1 0 0 1.55">
				<Shape>
				  <Torus innerRadius="0.5" outerRadius="0.2"></Torus>
				  <Appearance>
					<ImageTexture url="water.jpg"></ImageTexture>
				  </Appearance>
				</Shape>
			</Transform>
			<Transform translation='-6 -1.5 -7'>
				<Shape>
					<ElevationGrid xDimension="7" zDimension="6" xSpacing="5.0" zSpacing="5.0" solid="false"
								  height=
										  "0, 0, 0, 0, 0, 0,0,
										  0, 0, 0, 0, 0, 0,
										  0.5, 0.25, 0, 0, 0.25, 0.5,0,
										  0.5, 0.25, 0, 0, 0.25, 0.5,0,
										  1, 0.5, 0.25, 0.25, 0.5, 1,0,
										  1.5, -2, -2, -2, 1, 1.5,0">
					</ElevationGrid>
					<Appearance>
						<ImageTexture url="mars.jpg"></ImageTexture> 
					</Appearance>
				</Shape>
			</Transform>
			<Transform translation='-3 5 10' rotation="0 1 0 3">
				<Shape>
					<IndexedLineSet coordIndex="0 1 2 3 4 5 2"
						colorIndex="0 1 2 3">
							<Coordinate point='0 0 0, 3 -1 0,5 -3 0,5.5 -5 0,10 -5.3 0, 10.5 -3 0,'></Coordinate>
							<Color color='1 1 0, 1 1 0, 0 1 1,0 1 1,0 1 1,0 1 1,0 1 1'></Color>
					</IndexedLineSet>
				</Shape>
			</Transform>
				<Transform translation='7 3 4' scale='1.2 1.2 1.2'>
					<Shape>
						<IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" solid="false"
							coordIndex="0 1 2 0" 
							colorIndex="0 0 0 0">
							<Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
							<Color color="1 0.5 0.5, 1 1 0,0 1 1, 1 0 0, 1 0 1, 1 1 0, 1 1 1"></Color>
						</IndexedFaceSet>
					</Shape>
				</Transform>
				<Transform translation='7 3 4' scale='1.2 1.2 1.2' rotation='1 0 1 1.6'>
					<Shape>
						<IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" solid="false"
							coordIndex="0 1 2 0" 
							colorIndex="0 0 0 0">
							<Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
							<Color color="1 0.5 1, 1 1 0,0 1 1, 1 0 0, 1 0 1, 1 1 0, 1 1 1"></Color>
						</IndexedFaceSet>
					</Shape>
				</Transform>
				<Transform rotation=" 0 1 0 4.8" translation="9 -1 -2" scale="0.7 0.7 0.7">
					<Shape>
						<Extrusion crossSection = "0 0 0 6  6 6 6 0"
									convex="true" spine="0 0 0 0 5 0" solid='false'>
						</Extrusion>
						<Appearance>
							<ImageTexture url="derevo.jpg"></ImageTexture>
						</Appearance>
					</Shape>
				</Transform>
				<Transform translation="5 0.2 0" rotation= "0 0 1 1.6">
				<Shape>
				  <Appearance>
						<ImageTexture url="dver.png"></ImageTexture>
				  </Appearance>
				  <Box size="2.3 .3 4"></Box>
				</Shape>
			</Transform>
			<Transform translation='7 0.5 0' rotation="1 0 0 1.5" DEF="TanezOleni"> 
					<Transform DEF="scal" scale="1 1 1">
							<inline  url="Deer.x3d"> </inline>
							<Transform translation='0 0 0' rotation="0 0 1 2" > 
								<inline  url="Deer.x3d"> </inline>
					</Transform>
				</Transform>
			</Transform>
			<Transform id="group2" translation="0 -1.4 3.5">
				<Group USE="der"></Group>
			</Transform>
			<PointLight location="0 30 -20" radius="1000" color="1 0 0" intensity="0.3" shadowIntensity="1" ></PointLight>
			<Transform DEF="Solnc" ID="Solnc" translation="-30 30 -10">	
				<Shape>
					<Appearance>
						<ImageTexture url="sol.jpg"></ImageTexture>
					</Appearance>
					<Sphere radius="10"></Sphere>
				</Shape>
			</Transform>
			<Transform translation="-20 10 0" DEF="Uran">
			<Shape>
				<Appearance>
					<ImageTexture url="uran.png"></ImageTexture>
				</Appearance>
				<Sphere radius="5"></Sphere>
			</Shape>
			</Transform>
			<Transform translation="0 20 20" DEF="Saturn">
			<Shape>
				<Appearance>
					<ImageTexture url="saturn.jpg"></ImageTexture>
				</Appearance>
				<Sphere radius="5"></Sphere>
			</Shape>
			</Transform>
			<Fog visibilityRange='200'></Fog>
			<Viewpoint id="front" position="10 0 0"></Viewpoint>
			<Viewpoint id="front" position="2 30 0" orientation="0 1 1 3"></Viewpoint>
			<Viewpoint id="front" position="0 1 15"></Viewpoint>
			
			<timeSensor DEF="time" cycleInterval="6" loop="true"></timeSensor>
			
			<PositionInterpolator DEF="move" key="0 0.5 1" keyValue="7 0.5 0  20 2 0  7 0.5 0"></PositionInterpolator>
			<Route fromNode="time" fromField ="fraction_changed" toNode="move" toField="set_fraction"></Route>
			<Route fromNode="move" fromField ="value_changed" toNode="TanezOleni" toField="translation"></Route>
			
			<PositionInterpolator DEF="move1" key="0 0.4 0.7 1" keyValue="-20 10 0  0 10 -20 20 10 0 -20 10 0 "></PositionInterpolator>
			<Route fromNode="time" fromField ="fraction_changed" toNode="move1" toField="set_fraction"></Route>
			<Route fromNode="move1" fromField ="value_changed" toNode="Uran" toField="translation"></Route>
			
			<PositionInterpolator DEF="move2" key="0 0.3 0.5 0.7 1 " keyValue="0 20 50  0 20 0 0 20 -30 0 -20 0 0 20 50 "></PositionInterpolator>
			<Route fromNode="time" fromField ="fraction_changed" toNode="move2" toField="set_fraction"></Route>
			<Route fromNode="move2" fromField ="value_changed" toNode="Saturn" toField="translation"></Route>

			<TimeSensor DEF='newTime' cycleInterval='0.5' loop='true'></TimeSensor>
			<PositionInterpolator DEF='ScInt' key='0 0.5 1' keyValue='1 1 1, 1.2 1.2 1.2, 1 1 1'></PositionInterpolator>
			<ROUTE fromNode='newTime' fromField='fraction_changed' toNode='ScInt' toField='set_fraction'></ROUTE>
        	<ROUTE fromNode='ScInt' fromField='value_changed' toNode='derk' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt' fromField='value_changed' toNode='derk3' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt' fromField='value_changed' toNode='derk4' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt' fromField='value_changed' toNode='derk6' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt' fromField='value_changed' toNode='derk8' toField='set_scale'></ROUTE>
			
			
			<TimeSensor DEF='newTime1' cycleInterval='0.5' loop='true'></TimeSensor>
			<PositionInterpolator DEF='ScInt1' key='0 0.5 1' keyValue='1 1 1, 0.8 0.8 0.8, 1 1 1'></PositionInterpolator>
			<ROUTE fromNode='newTime1' fromField='fraction_changed' toNode='ScInt1' toField='set_fraction'></ROUTE>
			<ROUTE fromNode='ScInt1' fromField='value_changed' toNode='derk1' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt1' fromField='value_changed' toNode='derk2' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt1' fromField='value_changed' toNode='derk5' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt1' fromField='value_changed' toNode='derk9' toField='set_scale'></ROUTE>
			<ROUTE fromNode='ScInt1' fromField='value_changed' toNode='derk7' toField='set_scale'></ROUTE>
			
			
			
			
			<Transform translation='-6 -2 -7'>
				<Shape>
					<ElevationGrid DEF="Dlava" ID="lava" xDimension="7" zDimension="6" xSpacing="5.0" zSpacing="5.0" solid="false"
								  height=
										  "0, 0, 0, 0, 0, 0,0,
										  0, 0, 0, 0, 0, 0,
										  0.5, 0.25, 0, 0, 0.25, 0.5,0,
										  0.5, 0.25, 0, 0, 0.25, 0.5,0,
										  1, 0.5, 0.25, 0.25, 0.5, 1,0,
										  1.5, -2, -2, -2, 1, 1.5,0">
					</ElevationGrid>
					<Appearance>
						<ImageTexture url="lava.jpg"></ImageTexture> 
					</Appearance>
				</Shape>
			</Transform>
			<PositionChaser DEF="PosCh" id="PosCh"></PositionChaser>
			<ROUTE fromNode="PosCh" fromField="value_changed" toNode="Dlava" toField="set_translation"></ROUTE>
			
			
			<navigationInfo type="walik" ></navigationInfo>
	</scene>
</X3D>
</body>
</html>
